

<!DOCTYPE html>
<html>
<head>
	<title>Happenings</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <link rel="stylesheet" href="stylesheets/leaflet.css" />
	  <link rel="stylesheet" href="stylesheets/app.css">
 <!--[if lte IE 8]><link rel="stylesheet" href="stylesheets/leaflet.ie.css" /><![endif]-->
</head>
<body>
	<div id="map"></div>
	<div id="header">
		<h5><h2>Happenings.</h2> What is happening around you through the lens of someone's phone</h5>
		<h6>Note: still a little buggy. Sometimes it decides not load photos. I could use some help on this project...<em><a href="https://github.com/rsudekum/Happenings">Fork it</a></em><h6>
	</div>
	
<<<<<<< HEAD
=======
			//les Map
			var map = new L.Map('map'),
			    tiles = new L.TileLayer('http://a.tiles.mapbox.com/v3/bobbysud.map-94xylfrd/{z}/{x}/{y}.png', {maxZoom: 17}),
			    photoLayer = new L.LayerGroup(),
<<<<<<< HEAD
			    clientId = 'f62cd3b9e9a54a8fb18f7e122abc52df',
			    circle;

			map.setView(new L.LatLng(37.790794553924414, -122.44709014892578), 13).addLayer(tiles);

			map.on('click', onMapClick);

			map.addLayer(photoLayer);

			function onMapClick(e) {
			    if (!circle) {
			        circle = new L.Circle(e.latlng, 1000, {
			            color: '#919191',
			            fill: true,
			            fillOpacity: 0.2,
			            weight: 0
			        });
			        map.addLayer(circle)
			    } else {
			        circle.setLatLng(e.latlng);
			    }

			    $().instagram({
			    	search: {
			    		lat: e.latlng.lat.toFixed(2),
			    		lng: e.latlng.lng.toFixed(2)
			    	},
			    	clientId: clientId,
			    	onComplete: function(photos){
			    		photoLayer.clearLayers();

			    		_.each(photos, function(photo) {
			    			if (photo.location)
			    			{
			    				var object =  new L.CircleMarker(new L.LatLng(photo.location.latitude, photo.location.longitude), {
			    					radius: 5
			    				});
			    				
			    				var photoTemplate = _.template($("#popupTemplate").html(), {photo: photo});
			    				object.bindPopup(photoTemplate);

			    				photoLayer.addLayer(object);
			    			}
			    		});
			    	}
			    });
			}



=======
			    searchRadius = new L.LayerGroup(),
			    clientId = 'f62cd3b9e9a54a8fb18f7e122abc52df',
			    searchPin = new L.Marker(new L.LatLng(37.790794553924414, -122.44709014892578), {draggable: true});
>>>>>>> gh-pages

			// Add zoom out button
      		$('<div>zoom out</div>')
      		  .addClass('zoom-out')
      		  .attr('title', 'See somewhere other than San Francisco, the map demo capital of the world.')
      		  .click(function() {
      		    map.setView(new L.LatLng(40.84706035607122, -94.482421875), 4);
      		  })
      		  .appendTo($('#map'));

<<<<<<< HEAD


		
=======
			searchPin.addEventListener('dragend', onMarkerDragEnd);
			searchPin.setLatLng(new L.LatLng(37.790794553924414, -122.44709014892578));

			map.setView(new L.LatLng(37.790794553924414, -122.44709014892578), 13);

			map.addLayer(tiles)
			   .addLayer(photoLayer)
			   .addLayer(searchPin)
			   .addLayer(searchRadius);

			function onLocationFound(e){
				searchPin.setLatLng(e.target._latlng);
				findPhotos(e.latlng);
			}

			function onMarkerDragEnd(e){
				findPhotos(e.target._latlng);
				searchRadius.clearLayers();
				var radius = new L.Circle(e.target._latlng, 2000, {
					color: '#919191',
					fill: true,
					fillOpacity: 0.2,
					weight: 0
				});

				searchRadius.addLayer(radius);
			}

			function findPhotos(latlng){
				$().instagram({
			    	search: {
			    		lat: latlng.lat.toFixed(2),
			    		lng: latlng.lng.toFixed(2)
			    	},
			    	clientId: clientId,
			    	onComplete: plotPhotos
			    });
			}

			function plotPhotos(photos){
				photoLayer.clearLayers();

	    		_.each(photos, function(photo) {
	    			if (photo.location)
	    			{
	    				var object =  new L.CircleMarker(new L.LatLng(photo.location.latitude, photo.location.longitude), {
	    					radius: 5
	    				});
	    				
	    				var photoTemplate = _.template($("#popupTemplate").html(), {photo: photo});
	    				object.bindPopup(photoTemplate);
	    				photoLayer.addLayer(object);
	    			}
	    		});	
			}

>>>>>>> gh-pages
	</script>
>>>>>>> master
	<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-22516962-1']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

	</script>

	<script id="popupTemplate" type="text/template">
	<div id="instagram-photo">
		<img src=<%= photo.images.thumbnail.url %>></div>
	</script>

 	<script src="javascripts/leaflet4/dist/leaflet.js"></script>
 	<script src="http://cdn.jquerytools.org/1.2.7/full/jquery.tools.min.js"></script>
 	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
 	<script src="javascripts/jquery.instagram.js"></script>
 	<script type="text/javascript" src="javascripts/underscore-min.js"></script>
 	<script type="text/javascript" src="javascripts/app.js"></script>
</body>
</html>
